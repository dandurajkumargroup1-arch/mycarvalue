
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the AutoValue application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "displayName": {
          "type": "string",
          "description": "The display name of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "photoURL": {
          "type": "string",
          "description": "The URL of the user's profile photo."
        },
        "whatsappNumber": {
          "type": "string",
          "description": "The user's WhatsApp mobile number."
        },
        "vehicleNumber": {
            "type": "string",
            "description": "The user's vehicle registration number."
        },
        "shopName": {
            "type": "string",
            "description": "The name of the mechanic's or agent's shop."
        },
        "location": {
            "type": "string",
            "description": "The location of the mechanic's or agent's shop."
        },
        "role": {
          "type": "string",
          "description": "The role of the user, defining their permissions and experience.",
          "enum": ["Owner", "Agent", "Mechanic", "Admin"]
        },
        "upiId": {
          "type": "string",
          "description": "The user's UPI ID for payments."
        },
        "bankAccountNumber": {
            "type": "string",
            "description": "The user's bank account number."
        },
        "bankIfscCode": {
            "type": "string",
            "description": "The user's bank IFSC code."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the user profile was created."
        },
        "lastUpdatedAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the user profile was last updated."
        }
      },
      "required": ["id", "email", "role"]
    },
    "CarValuation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Car Valuation",
      "type": "object",
      "description": "Represents a single car valuation performed by a user, with detailed sections.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string" },
        "paymentId": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" },
        "priceCheckReason": { "type": "string" },
        "make": { "type": "string" },
        "model": { "type": "string" },
        "variant": { "type": "string" },
        "fuelType": { "type": "string" },
        "transmission": { "type": "string" },
        "manufactureYear": { "type": "number" },
        "registrationYear": { "type": "number" },
        "registrationState": { "type": "string" },
        "ownership": { "type": "string" },
        "rcStatus": { "type": "string" },
        "insurance": { "type": "string" },
        "hypothecation": { "type": "string" },
        "engineMechanical": {
          "type": "object",
          "properties": {
            "engine": { "type": "string" },
            "gearbox": { "type": "string" },
            "clutch": { "type": "string" },
            "battery": { "type": "string" },
            "radiator": { "type": "string" },
            "exhaust": { "type": "string" },
            "suspension": { "type": "string" },
            "steering": { "type": "string" },
            "brakes": { "type": "string" }
          }
        },
        "exterior": {
          "type": "object",
          "properties": {
            "frontBumper": { "type": "string" },
            "rearBumper": { "type": "string" },
            "bonnet": { "type": "string" },
            "roof": { "type": "string" },
            "doors": { "type": "string" },
            "fenders": { "type": "string" },
            "paintQuality": { "type": "string" },
            "rust": { "type": "string" },
            "accidentHistory": { "type": "string" }
          }
        },
        "interior": {
          "type": "object",
          "properties": {
            "seats": { "type": "string" },
            "seatCovers": { "type": "string" },
            "dashboard": { "type": "string" },
            "steeringWheel": { "type": "string" },
            "roofLining": { "type": "string" },
            "floorMats": { "type": "string" },
            "ac": { "type": "string" },
            "infotainment": { "type": "string" }
          }
        },
        "electrical": {
          "type": "object",
          "properties": {
            "powerWindows": { "type": "string" },
            "centralLocking": { "type": "string" },
            "headlights": { "type": "string" },
            "indicators": { "type": "string" },
            "horn": { "type": "string" },
            "reverseCamera": { "type": "string" },
            "sensors": { "type": "string" },
            "wipers": { "type": "string" }
          }
        },
        "tyres": {
          "type": "object",
          "properties": {
            "frontTyres": { "type": "string" },
            "rearTyres": { "type": "string" },
            "spareTyre": { "type": "string" },
            "alloyWheels": { "type": "string" },
            "wheelAlignment": { "type": "string" }
          }
        },
        "safety": {
          "type": "object",
          "properties": {
            "airbags": { "type": "string" },
            "abs": { "type": "string" },
            "seatBelts": { "type": "string" },
            "childLock": { "type": "string" },
            "immobilizer": { "type": "string" }
          }
        },
        "documents": {
          "type": "object",
          "properties": {
            "rcBook": { "type": "string" },
            "insuranceDoc": { "type": "string" },
            "puc": { "type": "string" },
            "serviceRecords": { "type": "string" },
            "duplicateKey": { "type": "string" },
            "noc": { "type": "string" }
          }
        },
        "usage": {
          "type": "object",
          "properties": {
            "odometer": { "type": "string" },
            "usageType": { "type": "string" },
            "cityDriven": { "type": "string" },
            "floodDamage": { "type": "string" },
            "accident": { "type": "string" },
            "serviceCenter": { "type": "string" }
          }
        },
        "additional": {
          "type": "object",
          "properties": {
            "musicSystem": { "type": "string" },
            "reverseParkingSensor": { "type": "string" },
            "dashcam": { "type": "string" },
            "fogLamps": { "type": "string" },
            "gpsTracker": { "type": "string" }
          }
        },
        "valuationResult": { "type": "object" },
        "comparableListingsResult": { "type": "object" },
        "imageQualityResult": { "type": "object" }
      },
      "required": ["id", "userId", "paymentId", "make", "model", "manufactureYear", "createdAt"]
    },
    "Wallet": {
      "title": "Wallet",
      "type": "object",
      "description": "Represents a mechanic's wallet.",
      "properties": {
        "userId": {
          "type": "string"
        },
        "balance": {
          "type": "number"
        },
        "totalEarned": {
          "type": "number"
        },
        "lastWithdrawalDate": {
          "type": "string",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": ["userId", "balance", "totalEarned"]
    },
    "WithdrawalRequest": {
      "title": "Withdrawal Request",
      "type": "object",
      "description": "Represents a mechanic's request to withdraw funds.",
      "properties": {
        "userId": {
          "type": "string"
        },
        "amount": {
          "type": "number"
        },
        "upiId": {
          "type": "string"
        },
        "bankAccountNumber": {
            "type": "string"
        },
        "bankIfscCode": {
            "type": "string"
        },
        "status": {
          "type": "string",
          "enum": ["requested", "paid", "rejected"]
        },
        "rejectionReason": {
          "type": "string"
        },
        "requestedAt": {
          "type": "string",
          "format": "date-time"
        },
        "processedAt": {
          "type": "string",
          "format": "date-time"
        },
        "transactionId": {
          "type": "string"
        }
      },
      "required": ["userId", "amount", "status", "requestedAt"]
    }
  },
  "auth": {
    "providers": ["password"]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": { "$ref": "#/backend/entities/User" },
          "description": "Stores user profiles. Only the authenticated user can read/write their own document."
        }
      },
      {
        "path": "/users/{userId}/carValuations/{carValuationId}",
        "definition": {
          "entityName": "CarValuation",
          "schema": { "$ref": "#/backend/entities/CarValuation" },
          "description": "Stores individual car valuations for a user. A user can only access their own valuations."
        }
      },
      {
        "path": "/users/{userId}/wallet/{walletId}",
        "definition": {
          "entityName": "Wallet",
          "schema": { "$ref": "#/backend/entities/Wallet" },
          "description": "Stores the wallet for a mechanic."
        }
      },
      {
        "path": "/users/{userId}/withdrawalRequests/{requestId}",
        "definition": {
          "entityName": "WithdrawalRequest",
          "schema": { "$ref": "#/backend/entities/WithdrawalRequest" },
          "description": "Stores withdrawal requests in a subcollection under each user."
        }
      }
    ],
    "reasoning": "The Firestore data structure is user-centric. All user-specific data (valuations, wallet, withdrawals) is stored in subcollections under their main user document. This allows for simple, secure access control rules. Admins use collection group queries to access all withdrawal requests across all users for processing."
  }
}

    